<!DOCTYPE html><html><head>
      <title>README</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\user\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.9\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<link href="styles.css" rel="stylesheet">
<h1 id="geometry-run">Geometry Run </h1>
<h4 id="video-demo--httpsyoutubetc-oagxkckq">Video Demo:  <a href="https://youtu.be/TC-OAGXKckQ">https://youtu.be/TC-OAGXKckQ</a> </h4>
<h1 id="overview-and-game-logic">Overview and Game Logic </h1>
<p>Geometry Run is a puzzle/platformer. The goal of the game is to reach the end point with the least time possible. The lower the time, the better the score. Players are encouraged to replay for a better score. This game is written in lua using the LOVE framework.</p>
<h1 id="architecture">Architecture </h1>
<blockquote>
<p>main.lua</p>
</blockquote>
<p>This contains the main game loop and the majority of the logic. Other lua scripts are imported using<br>
<code>require</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code>require <span class="token string">"entity"</span>
require <span class="token string">"player"</span>
require <span class="token string">"wall"</span>
require <span class="token string">"box"</span>
require <span class="token string">"platform"</span>
require <span class="token string">"longPlatform"</span>
require <span class="token string">"invisibleBarrier"</span>
</code></pre><p>Some libraries require a reference to access their fields, luckily <code>require</code> can also return a reference to the imported lua script.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code>Object <span class="token operator">=</span> require <span class="token string">"classic"</span>
lume <span class="token operator">=</span> require <span class="token string">"lume"</span>
</code></pre><h2 id="libraries">Libraries </h2>
<ol>
<li>love</li>
</ol>
<blockquote>
<p>The main framework of this game. The LOVE API enables access to its callbacks such as <code>load()</code>, <code>update()</code> and <code>draw()</code>. These callbacks are responsible for initialisation, loop and visualisation of the game. Other modules such as <code>love.graphics</code>, <code>love.sound</code>, <code>love.filesystem</code> provides support to create a complete gameplay experience.</p>
</blockquote>
<ol start="2">
<li>Math</li>
</ol>
<blockquote>
<p>This build-in library handles mathematical operations. <code>Math.ceil()</code>, <code>Math.floor()</code> and <code>Math.abs()</code> are used extensively to make counting algorithms possible for animation and GUI purposes.</p>
</blockquote>
<ol start="3">
<li>lume</li>
</ol>
<blockquote>
<p>This library enables system file stream in and out of the lua application. Player highscores are stored locally at "..user\AppData\Roaming\GeometryRun\savedata.txt".</p>
</blockquote>
<ol start="4">
<li>Classic</li>
</ol>
<blockquote>
<p>This library is essential to the data structure of the game. It enables the creation of classes and their instances and the ability to inherit subclasses from a superclass.</p>
</blockquote>
<h2 id="love-framework">Love framework </h2>
<p>LOVE is an open source lightweight framework that provides essential tools to make 2D games. The most important feature it has is its callbacks.</p>
<h3 id="loveconft">love.conf(t) </h3>
<blockquote>
<p>This is first callback recieved from Love.  Inside this function, the game's launch configurations are set. This callback is only executed once per game session.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--This function is called before load()!</span>
<span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">conf</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1600</span>
    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">900</span>

    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>minwidth <span class="token operator">=</span> <span class="token number">1200</span>
    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>minheight <span class="token operator">=</span> <span class="token number">720</span>

    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>borderless <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>resizable <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>

    t<span class="token punctuation">.</span>window<span class="token punctuation">.</span>icon <span class="token operator">=</span> <span class="token string">"/sprites/player/playerJump1.png"</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>love.conf() does not need to be inside main.lua.</em></p>
<h3 id="loveload">love.load() </h3>
<blockquote>
<p>This is the second callback from Love. This is where the initialisation of variables, tables and their fields take place. This callback is also only executed once per game session.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">------game fields-------</span>
    game <span class="token operator">=</span>
    <span class="token punctuation">{</span>
        state <span class="token operator">=</span>
        <span class="token punctuation">{</span>
            menu <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            tutorial <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            prep <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            playing <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            gameOver <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    WINDOWS_WIDTH <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    WINDOWS_HEIGHT<span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">---------gui fields--------</span>
    menuTextEntryDelay <span class="token operator">=</span> <span class="token number">0.5</span>

    score <span class="token operator">=</span> <span class="token number">0</span>
    score_text <span class="token operator">=</span> <span class="token string">""</span>

    timer <span class="token operator">=</span> <span class="token number">0</span>
    fontPath <span class="token operator">=</span> <span class="token string">"/font/Xomai.ttf"</span>

    boxIMG <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"/sprites/box.png"</span><span class="token punctuation">)</span>

<span class="token comment">-------------sfx------------</span>
    bgm <span class="token operator">=</span> love<span class="token punctuation">.</span>audio<span class="token punctuation">.</span><span class="token function">newSource</span><span class="token punctuation">(</span><span class="token string">"/sounds/bgm.ogg"</span><span class="token punctuation">,</span><span class="token string">"stream"</span><span class="token punctuation">)</span>
    bgm<span class="token punctuation">:</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
    bgm<span class="token punctuation">:</span><span class="token function">setLooping</span><span class="token punctuation">(</span><span class="token keyword keyword-true">true</span><span class="token punctuation">)</span>
    bgm<span class="token punctuation">:</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">--------check for saved data------</span>

    <span class="token keyword keyword-if">if</span> love<span class="token punctuation">.</span>filesystem<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token string">"savedata.txt"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"HAVE FILE"</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-local">local</span> file <span class="token operator">=</span> love<span class="token punctuation">.</span>filesystem<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"savedata.txt"</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-local">local</span> data <span class="token operator">=</span> lume<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
        highscore <span class="token operator">=</span> data<span class="token punctuation">.</span>highscore
        highscore_text <span class="token operator">=</span> <span class="token function">formatScore</span><span class="token punctuation">(</span>highscore<span class="token punctuation">)</span>

    <span class="token keyword keyword-else">else</span>
        highscore <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword keyword-end">end</span>


<span class="token comment">---------init all objs---------</span>
    player <span class="token operator">=</span> <span class="token function">Player</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">450</span><span class="token punctuation">)</span>
    b1 <span class="token operator">=</span> <span class="token function">Box</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> <span class="token function">Platform</span><span class="token punctuation">(</span><span class="token number">460</span><span class="token punctuation">,</span><span class="token number">350</span><span class="token punctuation">)</span>

    objects <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span>player<span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span>b1<span class="token punctuation">)</span>
    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span>p<span class="token punctuation">)</span>

<span class="token comment">---------init tile map---------</span>
    walls<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    map <span class="token operator">=</span> <span class="token punctuation">{</span>

        <span class="token comment">--2D table here</span>

    <span class="token punctuation">}</span>


<span class="token comment">---------init game state------</span>
    <span class="token function">clearGameState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>menu <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
    love<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"Geometry Run"</span><span class="token punctuation">)</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Tables are also used to group variables in order to reuse common names.</em></p>
<h3 id="loveupdatedt">love.update(dt) </h3>
<p>This is the main game loop. This function is called every frame and all code inside is executed in the same frame. The <code>dt</code> argument is the time elapsed of the last frame. Many logic require this value to correctly increment their quantities namely player movements, animation updates, collisions, physics, scoring and more.</p>
<p>Assuming the application runs at 60 FPS, on average <code>dt</code> will be equal to <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mn>60</mn></mfrac><mo>≈</mo><mn>0.0167</mn><mtext>&nbsp;</mtext><mi>s</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>n</mi><mi>d</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\frac{1}{60} \approx 0.0167 \space seconds</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">60</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0.0167</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">seco</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span></span></span></span></span>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">-- cache the window size every frame for scalable GUI</span>
    WINDOWS_WIDTH <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    WINDOWS_HEIGHT<span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>menu <span class="token keyword keyword-or">or</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tutorial <span class="token keyword keyword-then">then</span>

        <span class="token comment">---------UI ANIMATIONS----------</span>
        <span class="token keyword keyword-if">if</span> menuTextEntryDelay <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword keyword-then">then</span>
            menuTextEntryDelay <span class="token operator">=</span> menuTextEntryDelay <span class="token operator">-</span> dt
        <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-if">if</span> menuTextEntryDelay <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword keyword-then">then</span>
            <span class="token function">loopMenuValue</span><span class="token punctuation">(</span>dt<span class="token punctuation">,</span>menuTextFadeTime<span class="token punctuation">,</span>menuTextAlpha<span class="token punctuation">)</span>
        <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-end">end</span>


    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>playing <span class="token keyword keyword-then">then</span>

        <span class="token comment">----------------entity physics updates--------------</span>
        <span class="token keyword keyword-for">for</span> k<span class="token punctuation">,</span> v <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>

            v<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

        <span class="token keyword keyword-end">end</span>


        <span class="token comment">--resolve all collisions before updating to next frame</span>
        <span class="token keyword keyword-local">local</span> isContinueCheck <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
        <span class="token keyword keyword-local">local</span> limit <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword keyword-while">while</span> isContinueCheck <span class="token keyword keyword-do">do</span>
            isContinueCheck <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
            limit <span class="token operator">=</span> limit <span class="token operator">+</span><span class="token number">1</span>

            <span class="token keyword keyword-if">if</span> limit <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token keyword keyword-then">then</span>
                <span class="token keyword keyword-break">break</span>
            <span class="token keyword keyword-end">end</span>

            <span class="token keyword keyword-for">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>objects<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword keyword-do">do</span>
                <span class="token keyword keyword-for">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">,</span> <span class="token operator">#</span>objects <span class="token keyword keyword-do">do</span>

                    <span class="token keyword keyword-local">local</span> collision <span class="token operator">=</span> objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token keyword keyword-if">if</span> collision <span class="token keyword keyword-then">then</span>
                        isContinueCheck <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
                    <span class="token keyword keyword-end">end</span>

                <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-end">end</span>

        <span class="token comment">-----------game updates------------</span>
        timer <span class="token operator">=</span>  timer <span class="token operator">+</span> dt
        score <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>timer<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
        score_text <span class="token operator">=</span> <span class="token function">formatScore</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>

        <span class="token comment">----------UI updates---------------</span>

        <span class="token function">loopPlayingValue</span><span class="token punctuation">(</span>dt<span class="token punctuation">,</span>pTextFadeTime<span class="token punctuation">,</span>pTextAlpha<span class="token punctuation">)</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The while-loop inside of this function will be executed in one frame, so it is possible to have lag spikes if the while-loop takes too long to break.</em></p>
<h3 id="lovedraw">love.draw() </h3>
<p>This is the second game loop that runs in the next frame after <code>love.update()</code>. This loop is responsible for drawing visuals on the game window. The <code>love.graphics</code> module is used heavily here to change fonts, set color of the pen used by LOVE to create visuals, print text on the screen etc.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tutorial <span class="token keyword keyword-then">then</span>

        <span class="token comment">---background---</span>
        color <span class="token operator">=</span> <span class="token function">util_RBGAtoDEC</span><span class="token punctuation">(</span><span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setBackgroundColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span>

        <span class="token comment">---instruction 1---</span>
        <span class="token function">changeFont</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Arrow keys to move."</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WINDOWS_HEIGHT <span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token punctuation">,</span><span class="token string">"center"</span><span class="token punctuation">)</span>

        <span class="token comment">---instruction box---</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>boxIMG<span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">250</span><span class="token punctuation">,</span> WINDOWS_HEIGHT<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span><span class="token number">30</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token operator">*</span><span class="token punctuation">(</span>boxIMG<span class="token punctuation">:</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Boxes are pushable."</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WINDOWS_HEIGHT <span class="token operator">/</span><span class="token number">2</span> <span class="token operator">-</span><span class="token number">30</span>  <span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token punctuation">,</span><span class="token string">"center"</span><span class="token punctuation">)</span>

        <span class="token comment">--fade text in and out after initial delay</span>
        <span class="token keyword keyword-if">if</span> menuTextEntryDelay <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword keyword-then">then</span>

            love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>menuTextAlpha<span class="token punctuation">)</span>
            love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Press SpaceBar to continue"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WINDOWS_HEIGHT <span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span><span class="token number">90</span>  <span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token punctuation">,</span><span class="token string">"center"</span><span class="token punctuation">)</span>

        <span class="token keyword keyword-end">end</span>

        <span class="token comment">--footer</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Press ESC to quit"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WINDOWS_HEIGHT <span class="token operator">-</span> <span class="token number">30</span>  <span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token punctuation">,</span><span class="token string">"center"</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Graphics drawn by <code>love.graphics.draw()</code> or <code>love.graphics.print()</code> uses the pen color set by the <code>love.graphics.setColor(r,g,b,a)</code>. So it is common that before each image is drawn, the pen color is set back to white by <code>love.graphics.setColor(1,1,1,1)</code>.</em></p>
<h3 id="lovekeypressedkey">love.keypressed(key) </h3>
<p>This callback is triggered everytime a key is pressed by the user. The <code>key</code> argument stores the name of the keypress as a string. Comparing a predefined key to the <code>key</code> variable enables user input to influence the state of the game.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">keypressed</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> key <span class="token operator">==</span> <span class="token string">"escape"</span> <span class="token keyword keyword-then">then</span>
        love<span class="token punctuation">.</span>event<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-return">return</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>playing <span class="token keyword keyword-or">or</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>gameOver <span class="token keyword keyword-then">then</span>

        <span class="token keyword keyword-if">if</span> key <span class="token operator">==</span><span class="token string">"r"</span> <span class="token keyword keyword-then">then</span>
            <span class="token function">hotRestart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">clearGameState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>prep <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
        <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-return">return</span>
    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>In the case of player movement, <code>love.keyboard.isDown()</code> is used inside <code>player.lua</code> instead of <code>main.lua</code>. This is crucial for collisions to work properly. See Collisions for more detail.</em></p>
<h2 id="game-state">Game State </h2>
<p>This game has 5 scenes and therefore 5 states:</p>
<ol>
<li>menu</li>
<li>tutorial</li>
<li>prep</li>
<li>playing</li>
<li>gameOver<br>
<br></li>
</ol>
<blockquote>
<p>These state are used as boolean flags inside <code>love.update()</code> and <code>love.draw()</code> to achieve scene dependent logic. There could only be one active state(scene) at a time!</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--initialisation of states</span>
<span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    game <span class="token operator">=</span>
    <span class="token punctuation">{</span>

        state <span class="token operator">=</span>
        <span class="token punctuation">{</span>
            menu <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            tutorial <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            prep <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            playing <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
            gameOver <span class="token operator">=</span> <span class="token keyword keyword-false">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>States can be changed on game events, or triggered by user input!</em></p>
<p>An example of using state flags to tell Love what to draw depending on the state of the game:</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>menu <span class="token keyword keyword-then">then</span>
        <span class="token comment">--draw menu scene</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tutorial <span class="token keyword keyword-then">then</span>
        <span class="token comment">--draw tutorial scene</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>prep <span class="token keyword keyword-then">then</span>
        <span class="token comment">--draw preperation scene</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>playing <span class="token keyword keyword-then">then</span>
        <span class="token comment">--draw game scene</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>gameOver <span class="token keyword keyword-then">then</span>
        <span class="token comment">--draw gameOver scene</span>
    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--resets all state flags</span>
<span class="token keyword keyword-function">function</span> <span class="token function">clearGameState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>menu <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
    game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>tutorial <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
    game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>prep <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
    game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>playing <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
    game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>gameOver <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em><code>clearGameState()</code> is always called before setting a new game state to true.</em></p>
<h3 id="menu">Menu </h3>
<p>The <code>menu</code> state is the default start up state. This scene consist of the title, a background image and one animated text to inform the player that pressing spacebar will begin the game. Once spacebar is pressed, the game will switch to the <code>tutorial</code> state.</p>
<img alt="example map" src="./screenshots//menu.png" class="center">
<h3 id="tutorial">Tutorial </h3>
<p>The tutorial scene gives the player 3 instructions, displays a background color, contains 1 animated text that informs the player pressing spacebar will continue to the next stage of the game. Once spacebar is pressed, the game will switch to the <code>prep</code> state.</p>
<img alt="example map" src="./screenshots//tutorial.png">
<h3 id="preperation">Preperation </h3>
<p>The preperation scene has one simple text, a background color, a timer and a highscore if the player has play this game at least once. Once the timer reaches 0, the game will switch to the <code>playing</code> state.</p>
<img alt="example map" src="./screenshots//preperation.png">
<h3 id="playing">Playing </h3>
<p>This is where the actual game takes place. This scene contains a static map, some obstacles that are either moveable or static, an animated player, a timer, a background image, an animated text to inform the player pressing "r" will restart the game scene, and an animated flag representing the end of the map. This game state will also activate physics behaviour for the player to movearound and collide with objects and not fall through the map. If the player presses "r", this game state will be set to <code>prep</code> and all map objects and timers are reset. If the player reaches the flag, the game state will be set to <code>gameOver</code>.</p>
<img alt="example map" src="./screenshots/game.png" class="center">
<img alt="example map" src="./screenshots/Screenshot3.png" class="center">
<h3 id="gameover">Gameover </h3>
<p>This is the last scene of the game. This scene consist of a text that congratulate the player if they reach a high score or encourage them to try again if they did not. It also consist of an animated text that informs the player pressing "r" will let them retry the level. If the player press "r" the game will switch back to <code>prep</code>.</p>
<img alt="example map" src="./screenshots/gameover.png">
<p><em>In any given state, pressing "ESC" will quit the application.</em></p>
<h2 id="data-structure">Data Structure </h2>
<p>This game consist of a parent/superclass object called <code>Entity</code> and all other objects are child/subclass of <code>Entity</code>. The <code>Entity</code> class act as a blueprint for these subclasses: <code>Player</code>, <code>Wall</code>, <code>Platform</code>, <code>LongPlatform</code>, <code>Box</code> and <code>InvisibleBarrier</code>. In plainer words, the player, the wall, the platform, the long Platform, the box and the invisible Barrier are all entities, but the player for example, can have extra functionalities that differs from other entities such as the wall or the box.</p>
<blockquote>
<p>The <code>classic</code> library allows for the implementation of classes in lua.</p>
</blockquote>
<p>The <code>classic</code> library must be imported in either <code>Entity.lua</code> or  <code>main.lua</code>. The latter is possible because <code>Entity.lua</code> is imported anyway after importing <code>classic</code>:</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--in main.lua</span>

Object <span class="token operator">=</span> require <span class="token string">"classic"</span>
require <span class="token string">"Entity.lua"</span>
</code></pre><p>To create a the <code>Entity</code> class:</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--in Entity.lua</span>

<span class="token comment">-- Entity is now a class extended/inherited from the "classic" base object called Object</span>
Entity <span class="token operator">=</span> Object<span class="token punctuation">:</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>In <code>Entity.lua</code>, there are 3 non collision related functions defined.</p>
<blockquote>
<p>An instance of <code>Entity</code> can be created by calling <code>Entity()</code>, <code>Entity:new()</code> is the constructor for the base <code>Entity</code> class.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>image_path<span class="token punctuation">)</span>

    <span class="token comment">--all subclasses of Entity have these fields as well</span>
    self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
    self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
    self<span class="token punctuation">.</span>image <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>width <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>height <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">""</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Inside of the constructor function, all base fields of <code>Entity</code> are declared and populated.</em></p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">--handles movement or collision related logic (more detail later)</span>

    <span class="token comment">--updates self.x and self.y</span>

<span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">--draws image at coordinates self.x, and self.y</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span>self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The <code>self</code> keyword in lua is a way to reference the instance of the object passed into the function. When a function is defined with a <code>:</code> symbol instead of a <code>.</code>, any instance calling such functions must pass itself into the function as an argument, for example: <code>&lt;instance_of_entity&gt;.func(self)</code> or <code>&lt;instance_of_entity&gt;:func()</code></em></p>
<blockquote>
<p>Subclasses of <code>Entity</code> inherit these base functions and they can override them.</p>
</blockquote>
<p>Since <code>Player</code> is the most complicated subclass of <code>Entity</code> and other subclasses derives from the same yet simpler concept, the understanding of the working principle of <code>Player</code> is transferrable to said subclasses.</p>
<blockquote>
<p>To create a subclass <code>Player</code> that inherits from superclass <code>Entity</code>, write on the first line of <code>player.lua</code>:</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code>Player <span class="token operator">=</span> Entity<span class="token punctuation">:</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>In <code>player.lua</code>, the <code>new()</code> constructor function is overrided to take only <code>x</code> and <code>y</code> as arguments.<br>
However, in order to create an instance the <code>Player</code> subclass, the super class <code>Entity</code> have to be instanced first.</p>
<blockquote>
<p>All subclass constructors does not have <code>image_path</code> as argument because within their respective scripts, the image path is hard coded in the argument when the <code>Entity</code> superclass is instanced.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside player.lua</span>
Player <span class="token operator">=</span> Entity<span class="token punctuation">:</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

    <span class="token comment">--instances the superclass with the instance of this subclass using the "self" keyword</span>
    Player<span class="token punctuation">.</span>super<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">"sprites/player/player1.png"</span><span class="token punctuation">)</span>

    <span class="token comment">--Player specified fields (in super class)</span>
    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">10</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"player"</span>

    <span class="token comment">--Player's unique fields (NOT in super class)</span>
    self<span class="token punctuation">.</span>canJump <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Subclasses can have their unique fields declared inside their own constructor. These fields will not exist in or affect the superclass.</em></p>
<p><em>Note that the self keyword here represents the instance of <code>player</code> and <code>super</code> represents the instance of <code>Entity</code>. If <code>Player.super:new()</code> is used instead, the <code>Player</code> subclass will not be instanced because the <code>:</code> symbol here passes the <code>super</code>'s instance into <code>Entity</code>'s <code>new()</code> function. For details please read <code>classic</code>'s documentation.</em></p>
<p>Inside <code>main.lua</code>, the player object is instanced inside <code>love.load()</code> and stored inside table <code>objects</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">--initialise player at (-100,450)</span>
    player <span class="token operator">=</span> <span class="token function">Player</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">450</span><span class="token punctuation">)</span>

    objects <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>objects<span class="token punctuation">,</span>player<span class="token punctuation">)</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Recall in <code>Player.lua</code>, Player:new() only has 2 arguments!</em></p>
<p>Once the player is instanced as the variable <code>player</code>, all functions inherited from <code>Entity</code> or uniquely declared inside the <code>Player</code> subclass can be called using:</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code>player<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>For the purpose of this game, physics are handled in the <code>update()</code> function in all subclasses of <code>Entity</code>.In the <code>Player</code> subclass, user input and movement are processed on top of physics. So it is important that the data structure this game chooses allows for an inheritance structure where complex subclasses share the basic functionality of its sibling classes without the need to repeat the same code.</p>
<blockquote>
<p>The elegance of the inheritance structure will be revisited in the Physics section.</p>
</blockquote>
<h2 id="physics">Physics </h2>
<p>The physics of this game comprise of 2 main aspects:</p>
<ol>
<li>Kinematics</li>
<li>Collisions</li>
</ol>
<p>To begin understanding the physics of the game, having a frame of reference (position of (0,0)) and defining a pair of orthogonal axis is vital.</p>
<p>By default, the screen's top left corner will be positioned at (0,0) of the coordinate system, the horizontal axis increases from left to right while the vertical axis increases from top to bottom.</p>
<img alt="example map" src="./screenshots//coordinate.png">
<p><em>In a 1920x1080 sized window, the bottom right pixel will be exactly (1920,1080)</em></p>
<h3 id="kinematics">Kinematics </h3>
<p>The kinematics of this game has 2 parts: gravity and movement. Both are essential for creating realism for the player when they traverse on a bunch of "floating" blocks.</p>
<h4 id="movement">Movement </h4>
<p>Movement is the core feature of most games. In this game, the player is controlled by user input. The way to convey movement is to increment the horizontal and vertical position of the player in the <code>love.update()</code> loop and then draw the player at the updated position in the <code>love.draw()</code> loop.</p>
<blockquote>
<p>To make sure that all entities have their phyiscs updated synchronously, all entity instances will call their respective <code>update()</code> function inside <code>love.update()</code>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> k<span class="token punctuation">,</span> v <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>

        v<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The <code>objects</code> table contains all entities except walls.</em></p>
<p>All entities have a position related field <code>self.x</code> and <code>self.y</code>. They represent the current horizontal and vertical position of the entity.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>image_path<span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
    self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
    self<span class="token punctuation">.</span>spawnX <span class="token operator">=</span> x
    self<span class="token punctuation">.</span>spawnY <span class="token operator">=</span> y
    self<span class="token punctuation">.</span>image <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>width <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>height <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em><code>self.x</code> and <code>self.y</code> are set to the spawn coordinate of that entity at initialisation, these two variables will be updated frequently if the entity is a dynamic object such as the player or the boxes.</em></p>
<blockquote>
<p>To move the player, increment the <code>self.x</code> or <code>self.y</code> variable in <code>update()</code>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside player.lua</span>
<span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
    <span class="token comment">-- moves player to the right by 200*dt units per frame</span>
    self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">200</span> <span class="token operator">*</span> dt
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The 200 here is a hardcoded value that represents the speed factor of the player. 200 is not 200 m/s per say but a value that could be calibrated to determine how fast the player moves.</em></p>
<p>However, the player requires unique features, therefore <code>player:update()</code> not only uses the base <code>update()</code> logic from <code>Entity</code>, but with code that handles user input, jumping, animations and sound effects as well.</p>
<blockquote>
<p>Combine user input and movement using the <code>love.keyboard</code> module.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">-------------jump logic------------</span>
    <span class="token comment">--see later</span>

    <span class="token comment">--------gravity and collisions-------</span>
    Player<span class="token punctuation">.</span>super<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>dt<span class="token punctuation">)</span>
    <span class="token comment">--see later</span>

    <span class="token comment">--------movement logic------------</span>
    <span class="token keyword keyword-if">if</span> love<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">isDown</span><span class="token punctuation">(</span><span class="token string">"left"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">200</span> <span class="token operator">*</span> dt
    <span class="token keyword keyword-elseif">elseif</span> love<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">isDown</span><span class="token punctuation">(</span><span class="token string">"right"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token number">200</span> <span class="token operator">*</span> dt
    <span class="token keyword keyword-end">end</span>

    <span class="token comment">------------animation logic---------</span>
    <span class="token comment">--see later</span>
    <span class="token comment">------------sfx updates--------------</span>
    <span class="token comment">--see later</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>When the user presses the left arrow key, the player moves to the left; when the user presses the right arrow key, the player moves to the right.</em></p>
<p>Finally, to visualise movement, the player along with all other objects are drawn on the screen one frame after <code>love.update()</code> is called.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside main.lua</span>
<span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> k<span class="token punctuation">,</span> v <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>
        v<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><blockquote>
<p>Recall that <code>v:draw()</code> calls the defined function <code>draw()</code> inside the superclass <code>Entity</code>, if no subclasses overrides this function.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span>self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>This is a simiplified way to implement movement, the player will eventually move out of the screen. For games that have a map that is bigger than 1920x1080 such as this one, the game window has to follow the player whilst keeping static objects in the correct relative position to the player. See Camera Follow Effect for more details.</em></p>
<h4 id="gravity-and-jumping">Gravity and jumping </h4>
<p>Gravity is required for the player and boxes only. Since all game scene object are entities, inside the constructor of <code>Entity</code>, fields such as <code>downwardsVelocity</code> and <code>gravity</code> is added. <code>downwardsVelocity</code> is the velocity factor of the entity, whilst <code>gravity</code> is the acceleration factor. <code>gravity</code> is kept at 900 for the player, whereas the <code>Box</code> object has <code>gravity</code> set at 850 as it simulates "air resistance" so it falls slower than the player. All other entities are static objects, so their <code>gravity</code> values are set to zero.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--all objc</span>
<span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>image_path<span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
    self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
    self<span class="token punctuation">.</span>image <span class="token operator">=</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>width <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>height <span class="token operator">=</span> self<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment">-- Add the gravity and weight properties</span>
    self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">--g is constant across all objects</span>
    self<span class="token punctuation">.</span>gravity <span class="token operator">=</span> <span class="token number">900</span>
<span class="token keyword keyword-end">end</span>
</code></pre><pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside box.lua</span>
<span class="token keyword keyword-function">function</span> Box<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
    Box<span class="token punctuation">.</span>super<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">"sprites/box.png"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">1</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"box"</span>
    self<span class="token punctuation">.</span>gravity <span class="token operator">=</span> <span class="token number">850</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p>Besides adding new fields to the constructor of <code>Entity</code>, the <code>update()</code> function of <code>Entity</code> needs to be appended as well. The downwards velocity factor of all entities are updated every frame. The bigger their <code>gravity</code> variable, the faster <code>downwardsVelocity</code> will grow. Following that, the vertical position of the entity is incremented.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">=</span> self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">+</span> self<span class="token punctuation">.</span>gravity<span class="token operator">*</span>dt
    self<span class="token punctuation">.</span>y <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>downwardsVelocity<span class="token operator">*</span>dt

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Recall objects moves by a very small amount per frame using the <code>dt</code> argument, a value bigger than 1 can be multiplied onto <code>dt</code> to achieve a larger increment per frame</em></p>
<p>Implementing jumping is similar to gravity, but in the opposite direction. Since the vertical position of the player is incremented by a velocity factor, changing <code>downwardsVelocity</code> to a negative value will send the player in a upwards trajectory.</p>
<blockquote>
<p><code>jump()</code> is called when the user press the up arrow key.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">-------------jump logic------------</span>
    <span class="token keyword keyword-if">if</span> love<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">isDown</span><span class="token punctuation">(</span><span class="token string">"up"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">:</span><span class="token function">jump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">jump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> <span class="token keyword keyword-not">not</span> self<span class="token punctuation">.</span>canJump <span class="token keyword keyword-then">then</span>
        <span class="token keyword keyword-return">return</span>
    <span class="token keyword keyword-end">end</span>
    jumpSound<span class="token punctuation">:</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">350</span>
    self<span class="token punctuation">.</span>canJump <span class="token operator">=</span><span class="token keyword keyword-false">false</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em><code>self.canJump</code> is a boolean gate that controls whether the player can jump or not. This variable is set to false when the player jumps and when the player is in mid-air, and is set to true when the player collides with the top surface of any other entity</em></p>
<p>Fortunately, the player will not indefinitely travel upwards, thanks to how gravity is implemented. Since <code>downwardsVelocity</code> is always increasing per frame, it will eventually become zero and turn positive again, effectively modelling the vertical velocity of a realistic projectile motion.</p>
<h3 id="collisions">Collisions </h3>
<p>In almost every platformer, collisions are the bread and butter of the game. All entities in this game have collision built into their base functionality in <code>entity.lua</code>. Before detailing how collisions are handled in this game, the basic concept of collision has to be discussed.</p>
<h4 id="detecting-collisions">Detecting Collisions </h4>
<p>Consider 2 rectangles. Rectangle A has width <code>A.width</code> and length <code>A.length</code> while rectangle B  has  width <code>B.width</code> and length <code>B.length</code>. Rectangle A has coordinates <code>A.x</code> and <code>A.y</code> while rectangle B has coordinates <code>B.x</code> and <code>B.y</code>. These cooridnates are pivoted at the top left corner of these rectangles.</p>
<img class="center" alt="example map" src="./screenshots//collision.png">
<p><em>The thickness of the borders are negligible, recall that the top left corner of the screen is (0,0) and <code>x</code> increases rightwards whereas <code>y</code> increases downwards.</em></p>
<p>In order for these 2 rectangular objects to collide, the following conditions must be satisfied simultaneously:</p>
<ol>
<li>
<blockquote>
<p><code> A.x + A.width &gt; B.x</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>A.x &lt; B.x + B.width</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>A.y + A.height &gt; B.y</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>A.y &lt; B.y + B.height</code></p>
</blockquote>
</li>
</ol>
<p>To check for collision between entities, an instance of entity calls <code>checkCollision()</code> defined in <code>entity.lua</code>, while passing the instance of another entity as variable. <code>checkCollision()</code> returns true when all the conditions are met and false otherwise.</p>
<blockquote>
<p>The entity instance that called <code>checkCollision()</code> will always be referenced by the <code>self</code> keyword.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width <span class="token operator">&gt;</span> target<span class="token punctuation">.</span>x
    <span class="token keyword keyword-and">and</span> self<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>x <span class="token operator">+</span> target<span class="token punctuation">.</span>width
    <span class="token keyword keyword-and">and</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>height <span class="token operator">&gt;</span> target<span class="token punctuation">.</span>y
    <span class="token keyword keyword-and">and</span> self<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>y <span class="token operator">+</span> target<span class="token punctuation">.</span>height
<span class="token keyword keyword-end">end</span>
</code></pre><p>Finally, all entities are put in a loop and collisions between them are checked without repeat (order does not matter here, meaning if A checked collisions with B, B does not need to check collisions with A).</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>objects<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword keyword-do">do</span>
        <span class="token keyword keyword-for">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">,</span> <span class="token operator">#</span>objects <span class="token keyword keyword-do">do</span>
            objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em><code>#objects</code> returns the number of elements inside the table <code>objects</code>.</em></p>
<p>Checking for collisions is only the first step, resolving them accordingly will be the next.</p>
<h4 id="resolving-collisions">Resolving Collisions </h4>
<h5 id="2-body-collisions">2-body Collisions </h5>
<p>Resolving a collision involves breaking apart a collision and setting the 2 colliding bodies in a way such that they are just touching each other. However there is an conundrum:</p>
<blockquote>
<p>If one body collides with another, which colliding body should move? Should the moving body be "bounced" back? Or should the recieving body be pushed forward?</p>
</blockquote>
<p>Fortunately for games, it is intuitive that static walls/plaforms should not be pushed by anything, while dynamic objects such as boxes should be able to move in the direction of where the player is pushing them from.</p>
<p>To implement such behaviour, a <code>materialStrength</code> field is added into the each entity.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--in Entity.lua</span>
<span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>image_path<span class="token punctuation">)</span>
    <span class="token comment">----------------</span>
    <span class="token comment">--other fields--</span>
    <span class="token comment">--     ...    --</span>
    <span class="token comment">----------------</span>

    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword keyword-end">end</span>
</code></pre><pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--in platform.lua</span>
<span class="token keyword keyword-function">function</span> Platform<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
    Platform<span class="token punctuation">.</span>super<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">"sprites/platform.png"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The <code>materialStrength</code> variable is set at initialisation by each subclass of <code>Entity</code>.</em></p>
<p>Static entities will always have a higher strength value than dynamic entities, whereas between dynamic entities, the one that "moves" the rest of the entites will have a moderate strength value and the rest will have the lowest strength value.</p>
<p>In this game, the strength values are distributed as follow:</p>
<blockquote>
<p>Walls and platforms:  100       <br><br>
Player:  10                     <br><br>
Box:  1</p>
</blockquote>
<p>When a light object collides with a heavy object whilst coming from the left, the light object is send back to the left while the heavy object stays in place. As for how much the object has to be sent back, that depends on the width of the light object only.</p>
<p>Consider the same rectangle A and B and they are now subclasses of <code>Entity</code>. A travels from left to right colliding with a static object B. A will be sent back to the left by just the right amount where its right side touches B's left side, and B remains in the same position.</p>
<blockquote>
<p><code>checkCollision()</code> is called inside a new function <code>resolveCollision()</code>. If <code>checkCollision()</code> returns true, and if the caller of <code>resolveCollision()</code> is <em>ligher</em> than the instance it passes ,<code>target</code>, and if the caller is on the left of the target, the collision is resolved.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--in main.lua</span>
<span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">-----loop over all objects----</span>

        instance_A<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>instance_B<span class="token punctuation">)</span>

    <span class="token comment">-------------------------</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p>*<code>instance_A</code> and <code>instance_B</code> are initialised before the first <code>update()</code> callback. *</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">-- in entity.lua</span>
<span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>

    <span class="token comment">-- collision in this frame?</span>
    <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>  <span class="token keyword keyword-then">then</span>

        <span class="token comment">--if the caller's is heavier than the target, call resolveCollision again with target being the caller and the original caller as the target.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>materialStrength <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>materialStrength<span class="token punctuation">)</span><span class="token keyword keyword-then">then</span>

            <span class="token keyword keyword-return">return</span> target<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>

        <span class="token keyword keyword-end">end</span>

        <span class="token comment">--check if mid point of self is more left than the mid point of target</span>
        <span class="token keyword keyword-if">if</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>x <span class="token operator">+</span> target<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token keyword keyword-then">then</span>
            <span class="token comment">--resolve the collision</span>
            self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> target<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token keyword keyword-end">end</span>


    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The reason why the caller must be the one calling the <code>resolveCollision()</code> function, it is due to how the last part is written. <code>self</code> is always the one being moved back, never the <code>target</code>. So <code>self</code> must have a smaller strength value than <code>target</code>.</em></p>
<p>On paper this is how a perfectly head on collision from the left is resolved. However, in most cases, collisions can occur at any incoming direction. The current collision system will break if rectangle A collides with B coming from the top given that A is slightly more to the left than B. Resolving the collision using the code above will result in A snapping on B's left side regardless of how A collides with B, as long as A is slightly more left than B.</p>
<blockquote>
<p><code>checkCollision()</code> only checks for a generic collision at the current frame, it will not give any information about how the collision happened (A hits B from what direction etc).</p>
</blockquote>
<p>To tackle this problem, 2 new fields are needed for each entity.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>image_path<span class="token punctuation">)</span>
    <span class="token comment">----------------</span>
    <span class="token comment">--other fields--</span>
    <span class="token comment">--     ...    --</span>
    <span class="token comment">----------------</span>

    self<span class="token punctuation">.</span>lastX <span class="token operator">=</span> x
    self<span class="token punctuation">.</span>lastY <span class="token operator">=</span> y

<span class="token keyword keyword-end">end</span>
</code></pre><p>By caching the the position of each entity every frame before any movement/collision updates, at the frame where the collision actually happened. Entities can compare their last-frame positions, to determine whether they were already horizontally colliding or vertically colliding.</p>
<img alt="" src="./screenshots/lastFrameCollision.png">
<p><em>When A is about to horizontally collide with B, they must already be vertically colliding and vice versa.</em></p>
<blockquote>
<p>In <code>Entity:update()</code>, <code>self.lastX</code> and <code>self.lastY</code> are set to the current position of the entity BEFORE any updates.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">--CACHE FIRST</span>
    self<span class="token punctuation">.</span>lastX <span class="token operator">=</span> self<span class="token punctuation">.</span>x
    self<span class="token punctuation">.</span>lastY <span class="token operator">=</span> self<span class="token punctuation">.</span>y

    <span class="token comment">--THEN UPDATE GRAVITY!</span>
    self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">=</span> self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">+</span> self<span class="token punctuation">.</span>gravity<span class="token operator">*</span>dt
    self<span class="token punctuation">.</span>y <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>downwardsVelocity<span class="token operator">*</span>dt

<span class="token keyword keyword-end">end</span>
</code></pre><p>Define a new function, <code>isLastFrameVerticallyColliding()</code>. This functions is called before resolving horizontal collisions by comparing the <code>lastY</code> values of the colliding entities.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">isLastFrameVerticallyColliding</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span>  self<span class="token punctuation">.</span>lastY <span class="token operator">+</span> self<span class="token punctuation">.</span>height <span class="token operator">&gt;</span> target<span class="token punctuation">.</span>lastY
    <span class="token keyword keyword-and">and</span> self<span class="token punctuation">.</span>lastY <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>lastY <span class="token operator">+</span> target<span class="token punctuation">.</span>height
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>This is half of the conditions inside <code>checkCollision()</code>, in this case only the vertical collision conditions needs to be met in order to return true.</em></p>
<p>Finally, puting everything together, horizontal collisions are now resolved without unexpected behaviour.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">-- in entity.lua</span>
<span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>

    <span class="token comment">-- collision in this frame?</span>
    <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>  <span class="token keyword keyword-then">then</span>

        <span class="token comment">-- vertically colliding in the last frame?</span>
        <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isLastFrameVerticallyColliding</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>

            <span class="token comment">--if the caller's is heavier than the target, call resolveCollision again with target being the caller and the original caller as the target.</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>materialStrength <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>materialStrength<span class="token punctuation">)</span><span class="token keyword keyword-then">then</span>

                <span class="token keyword keyword-return">return</span> target<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>

            <span class="token keyword keyword-end">end</span>

            <span class="token comment">--check if mid point of self is more left than the mid point of target</span>
            <span class="token keyword keyword-if">if</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>x <span class="token operator">+</span> target<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token keyword keyword-then">then</span>
                <span class="token comment">--resolve the collision</span>
                self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> target<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
            <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p>The same concept applies to vertical collisions, but for the sake of simplicity in this part, only horizontal collisions are considered. For a step by step demostration of how this game implements its collisions, check <em>Implementing Collision</em> for more.</p>
<h5 id="n-body-collisions">N-body Collisions </h5>
<p>In this game, the player can push a box into the wall and the wall theorectically should stop all entities from going through itself. However, with only 2-body collisions and a single for-loop per frame to check collisions between all objects, the player could potential clip into the box and eventually come to a stop when the it collides with the wall.</p>
<p>To solve this problem, 2 new fields are required to store the temporary material strength obtained during a series of collisions. With this new variable, the box can temporarily share the same strength value as the wall so when the player collides on to it, the player will be pushed back.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>image_path<span class="token punctuation">)</span>

    <span class="token comment">----------------</span>
    <span class="token comment">--other fields--</span>
    <span class="token comment">--     ...    --</span>
    <span class="token comment">----------------</span>

    self<span class="token punctuation">.</span>tempStrengthX <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>tempStrengthY <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p>Inside <code>resolveColliion()</code>, if the current frame collision is horizontal, then set <code>self.tempStrengthX</code> to <code>target.tempStrengthX</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>

    <span class="token comment">-- collision in this frame?</span>
    <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>  <span class="token keyword keyword-then">then</span>

        <span class="token comment">-- vertically colliding in the last frame?</span>
        <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isLastFrameVerticallyColliding</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>

            <span class="token comment">--!</span>
            <span class="token comment">--lighter object inherits strength of stronger object</span>
            self<span class="token punctuation">.</span>tempStrengthX <span class="token operator">=</span> target<span class="token punctuation">.</span>tempStrengthX

            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>materialStrength <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>materialStrength<span class="token punctuation">)</span><span class="token keyword keyword-then">then</span>

                <span class="token keyword keyword-return">return</span> target<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>

            <span class="token keyword keyword-end">end</span>

            <span class="token comment">--check if mid point of self is more left than the mid point of target</span>
            <span class="token keyword keyword-if">if</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>x <span class="token operator">+</span> target<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token keyword keyword-then">then</span>
                <span class="token comment">--resolve the collision</span>
                self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> target<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
            <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p>All temporary strength values are set back to their entities' default every <code>update()</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">--CACHE FIRST</span>
    self<span class="token punctuation">.</span>lastX <span class="token operator">=</span> self<span class="token punctuation">.</span>x
    self<span class="token punctuation">.</span>lastY <span class="token operator">=</span> self<span class="token punctuation">.</span>y

    <span class="token comment">--RESET STRENGTH VALUESS</span>
    self<span class="token punctuation">.</span>tempStrengthX <span class="token operator">=</span> self<span class="token punctuation">.</span>materialStrength
    self<span class="token punctuation">.</span>tempStrengthY <span class="token operator">=</span> self<span class="token punctuation">.</span>materialStrength

    <span class="token comment">--THEN UPDATE GRAVITY!</span>
    self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">=</span> self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">+</span> self<span class="token punctuation">.</span>gravity<span class="token operator">*</span>dt
    self<span class="token punctuation">.</span>y <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>downwardsVelocity<span class="token operator">*</span>dt

<span class="token keyword keyword-end">end</span>
</code></pre><p>Howevver, this works fine only when the player resolves collision with the box AFTER the box has resolved collision with the wall. Fortunately, while-loops can be used in <code>love.update()</code> to resolve collisions between all objects multiple times in the same frame. So even if the player has resolve collision with the box before the box has its strength updated, the while loop will make sure the player resolves collisions with the box again in the next tick.</p>
<blockquote>
<p><code>resolveCollision()</code> is tweaked slightly to return true when the collision is resolved, it returns false otherwise.</p>
</blockquote>
<blockquote>
<p>The while-loop is set to break in the begining of the tick, only when there are collisions still being resolved will the while-loop be allowed to continue.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--in main.lua</span>
<span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">--resolve all collisions before next user input/gravity update</span>
    <span class="token keyword keyword-local">local</span> isContinueCheck <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
    <span class="token keyword keyword-local">local</span> limit <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword keyword-while">while</span> isContinueCheck <span class="token keyword keyword-do">do</span>
        isContinueCheck <span class="token operator">=</span> <span class="token keyword keyword-false">false</span>
        limit <span class="token operator">=</span> limit <span class="token operator">+</span><span class="token number">1</span>

        <span class="token comment">-- breaks then there is more than 10 consecutive collisions resolved to let the frame pass</span>
        <span class="token keyword keyword-if">if</span> limit <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token keyword keyword-then">then</span>
            <span class="token keyword keyword-break">break</span>
        <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-for">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">#</span>objects<span class="token operator">-</span><span class="token number">1</span> <span class="token keyword keyword-do">do</span>
            <span class="token keyword keyword-for">for</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">,</span> <span class="token operator">#</span>objects <span class="token keyword keyword-do">do</span>

                <span class="token keyword keyword-local">local</span> collision <span class="token operator">=</span> objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>objects<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-if">if</span> collision <span class="token keyword keyword-then">then</span>
                    isContinueCheck <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
                <span class="token keyword keyword-end">end</span>

            <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>It is crucial to set a limit to how many consecutive collisions are allowed to be resolved, or the while-loop will go on indefinitely and freeze the application.</em></p>
<p>Again, the same concept applies to vertical collisions where <code>self.tempStrengthY</code> is set to <code>target.tempStrengthY</code>. The reason behind seperating temporary strength to 2 directions is because vertical collisions should not interfere with horizontal ones. If the player resolved collisions with the "wall" block that is placed under the player, using one temporary strength variable means the player inherited the material strength of the wall, thus affecting its strength comparison horizontally with other entities and cause unexpected behaviours.</p>
<h4 id="implementing-collision">Implementing Collision </h4>
<p>This game adopts the N-body collision system and an additional filter per collision for anisotropic collision behaviours. An example of such behaviour is when the player collides with the platform from any direction other than from the top, collisions are ignored as to allow the player to jump onto the platform from underneath.</p>
<p>In <code>entity,lua</code>, <code>resolve()</code> abstracts the logic for moving <code>self</code> depending on which direction it approached the heavier object. <code>isAllowResolve()</code> is now called before resolving the collision to filter for unique collision behaviour between certain subclasses.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>comingFrom<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span> <span class="token string">"left"</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token operator">+</span>self<span class="token punctuation">.</span>width <span class="token operator">-</span> target<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token comment">--print("moving ".. self.name .. " to the left")</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span> <span class="token string">"right"</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>x <span class="token operator">+</span> target<span class="token punctuation">.</span>width <span class="token operator">-</span> self<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token comment">--print("moving ".. self.name .. " to the right")</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span> <span class="token string">"up"</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>height <span class="token operator">-</span> target<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        <span class="token comment">--print("moving ".. self.name .. " to the top")</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span> <span class="token string">"down"</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>y <span class="token operator">+</span> target<span class="token punctuation">.</span>height <span class="token operator">-</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        <span class="token comment">--print("moving ".. self.name .. " to the bottom")</span>
    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--for anisotropic collision behaviour, default returns true when the entity subclass doesnt override it</span>
<span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>comingFrom<span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>
<span class="token keyword keyword-end">end</span>
</code></pre><blockquote>
<p>Anisotropic collisions are require for player related collisions only, <code>resolve()</code> and <code>isAllowResolve()</code> are overriden for player specific behaviours in <code>player.lua</code> .</p>
</blockquote>
<p>Every time the player is resolved upwards, means the player has landed on another entity. In <code>player.lua</code>, the <code>resolve()</code> function is overrided by first calling the base function of <code>resolve()</code> then checking if the player came from above the target.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--only the player needs to reset the jump bool</span>
<span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>comingFrom<span class="token punctuation">)</span>

    Player<span class="token punctuation">.</span>super<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>target<span class="token punctuation">,</span>comingFrom<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span> <span class="token string">"up"</span> <span class="token keyword keyword-then">then</span>
        self<span class="token punctuation">.</span>canJump <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Setting <code>self.canJump</code> to <code>true</code> will allow the player to jump again.</em></p>
<p>When the player collides with any boxes, the box should make a grinding sound with the ground but not when the player is standing on top of the box. In <code>isAllowResolve()</code>, the target class is checked, followed by checking if the player is approaching the target horizontally. If all conditions are met, a sound effect will be played.</p>
<blockquote>
<p>This function will return always <code>true</code> if no extra behaviours stops the collision from getting resolved.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>comingFrom<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> target<span class="token punctuation">:</span><span class="token function">is</span><span class="token punctuation">(</span>Box<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>

        <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span><span class="token string">"right"</span>  <span class="token keyword keyword-or">or</span> comingFrom <span class="token operator">==</span><span class="token string">"left"</span>  <span class="token keyword keyword-then">then</span>
            isPlayBoxSound <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
        <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>

    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p>To enable the player to jump through the platforms, create another check for if the class type of the target then check if the player is approaching from the top. If the latter condition is not met, return false and that collision will not be resolved, allowing the player to go through the platform.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>comingFrom<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> target<span class="token punctuation">:</span><span class="token function">is</span><span class="token punctuation">(</span>Box<span class="token punctuation">)</span>  <span class="token keyword keyword-then">then</span>

        <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span><span class="token string">"right"</span>  <span class="token keyword keyword-or">or</span> comingFrom <span class="token operator">==</span><span class="token string">"left"</span>  <span class="token keyword keyword-then">then</span>
            isPlayBoxSound <span class="token operator">=</span> <span class="token keyword keyword-true">true</span>
        <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>

    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-if">if</span> target<span class="token punctuation">:</span><span class="token function">is</span><span class="token punctuation">(</span>Platform<span class="token punctuation">)</span> <span class="token keyword keyword-or">or</span> target<span class="token punctuation">:</span><span class="token function">is</span><span class="token punctuation">(</span>LongPlatform<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>

        <span class="token keyword keyword-if">if</span> comingFrom <span class="token operator">==</span><span class="token string">"up"</span> <span class="token keyword keyword-then">then</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>
        <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-false">false</span>

    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p>Finally append all of the above inside <code>Entity:resolveCollision()</code>, along with the vertical part that the previous section left out and a part where all entities will have their <code>downwardsVelocity</code> value set to zero when they collide onto another entity from the top. This concludes how collisions are handled in this game, the exact code snippet below is used in production.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">checkCollision</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>  <span class="token keyword keyword-then">then</span>

        <span class="token comment">--RESOLVE horizontal collision</span>
        <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isLastFrameVerticallyColliding</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>

            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>tempStrengthX <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>tempStrengthX<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
                <span class="token keyword keyword-return">return</span> target<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            <span class="token keyword keyword-end">end</span>

            <span class="token comment">--lighter object inherits strength of stronger object</span>
            self<span class="token punctuation">.</span>tempStrengthX <span class="token operator">=</span> target<span class="token punctuation">.</span>tempStrengthX

            <span class="token comment">--self coming from left</span>
            <span class="token keyword keyword-if">if</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>x <span class="token operator">+</span> target<span class="token punctuation">.</span>width<span class="token operator">/</span><span class="token number">2</span> <span class="token keyword keyword-then">then</span>

                <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"left"</span><span class="token punctuation">)</span> <span class="token keyword keyword-and">and</span> target<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token string">"right"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
                    self<span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"left"</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-else">else</span>
                    <span class="token comment">-- there is no collision resolved</span>
                    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-false">false</span>
                <span class="token keyword keyword-end">end</span>
            <span class="token comment">--self coming from right</span>
            <span class="token keyword keyword-else">else</span>

                <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"right"</span><span class="token punctuation">)</span> <span class="token keyword keyword-and">and</span> target<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token string">"left"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
                    self<span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"right"</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-else">else</span>
                    <span class="token comment">-- there is no collision resolved</span>
                    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-false">false</span>
                <span class="token keyword keyword-end">end</span>

            <span class="token keyword keyword-end">end</span>

        <span class="token comment">--RESOLVE vertical collision</span>
        <span class="token keyword keyword-elseif">elseif</span> self<span class="token punctuation">:</span><span class="token function">isLastFrameHorizontallyColliding</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>

            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>tempStrengthY <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>tempStrengthY<span class="token punctuation">)</span><span class="token keyword keyword-then">then</span>
                <span class="token keyword keyword-return">return</span> target<span class="token punctuation">:</span><span class="token function">resolveCollision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            <span class="token keyword keyword-end">end</span>

            <span class="token comment">--lighter object inherits strength of stronger object</span>
            self<span class="token punctuation">.</span>tempStrengthY <span class="token operator">=</span> target<span class="token punctuation">.</span>tempStrengthY

            <span class="token comment">--self coming from up</span>
            <span class="token keyword keyword-if">if</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">&lt;</span> target<span class="token punctuation">.</span>y <span class="token operator">+</span> target<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span> <span class="token keyword keyword-then">then</span>

                <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"up"</span><span class="token punctuation">)</span> <span class="token keyword keyword-and">and</span> target<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token string">"down"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
                    self<span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"up"</span><span class="token punctuation">)</span>
                    <span class="token comment">--all entities will reset their downwards v</span>
                    self<span class="token punctuation">.</span>downwardsVelocity <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword keyword-else">else</span>
                    <span class="token comment">-- there is no collision resolved</span>
                    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-false">false</span>
                <span class="token keyword keyword-end">end</span>
            <span class="token comment">--self coming from down</span>
            <span class="token keyword keyword-else">else</span>

                <span class="token keyword keyword-if">if</span> self<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"down"</span><span class="token punctuation">)</span> <span class="token keyword keyword-and">and</span> target<span class="token punctuation">:</span><span class="token function">isAllowResolve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token string">"up"</span><span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
                    self<span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token string">"down"</span><span class="token punctuation">)</span>
                <span class="token keyword keyword-else">else</span>
                    <span class="token comment">-- there is no collision resolved</span>
                    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-false">false</span>
                <span class="token keyword keyword-end">end</span>

            <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-end">end</span>
        <span class="token comment">-- there is collision resolved</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-true">true</span>

    <span class="token keyword keyword-end">end</span>
    <span class="token comment">-- there is no collision between the 2 objects in this frame</span>
    <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-false">false</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><em>The reason why <code>self:isAllowResolve(target)</code> AND <code>target:isAllowResolve(self)</code> must be checked simuntaneously is because all unique behaviours are overriden in <code>player.lua</code> but <code>self</code> does not always represent the player. In the player-box collison, the box's strength is lower than the player so <code>box:resolveCollision(player)</code> is called instead of <code>player:resolveCollision(box)</code>. Forcing <code>target</code> and <code>self</code> to swap places and run <code>isAllowResolve()</code> again will ensure <code>player:isAllowResolve(box)</code> to be called and proceed with the player specific behaviour.</em></p>
<h1 id="key-design-elements">Key Design Elements </h1>
<h2 id="map">Map </h2>
<p>The map in the game is created by a 2D table of zeros and ones, representing nothing and a wall tile respectively.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside main.lua ; love.load()</span>

    walls<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">--each wall image sprite is 50 px in height and width</span>
    wallSize <span class="token operator">=</span> <span class="token number">50</span>

    map <span class="token operator">=</span> <span class="token punctuation">{</span>

        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre><p>The ones' positions on the 2D table are translated into relative game coordinates in pixels using a simple algorithm inside a for-loop. A <code>Wall</code> object is constructed by calling <code>Wall()</code>. <code>Wall</code> being the subclass of <code>Entity</code> have its own constructor arguments <code>Wall:new(x,y)</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Wall<span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

    Wall<span class="token punctuation">.</span>super<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token string">"sprites/wall.png"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>materialStrength <span class="token operator">=</span> <span class="token number">100</span>
    self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"wall"</span>

    self<span class="token punctuation">.</span>gravity <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p>All wall objects are instanced with the translated pixel values passed in as <code>x</code> and <code>y</code>, and are inserted into the table <code>walls</code></p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside main.lua ; love.load()</span>

    <span class="token keyword keyword-for">for</span> i<span class="token punctuation">,</span> row <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>

        <span class="token keyword keyword-for">for</span> j<span class="token punctuation">,</span> col <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>

            <span class="token keyword keyword-if">if</span> col <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword keyword-then">then</span>
                table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>walls<span class="token punctuation">,</span> <span class="token function">Wall</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>wallSize <span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>wallSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-end">end</span>

</code></pre><p><em>The top left element of the <code>map</code> table will have game coordinates (0,0) while the bottom right element will have game coordinates <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mi>w</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi><mtext>&nbsp;</mtext><mo separator="true">,</mo><mtext>&nbsp;</mtext><mo stretchy="false">(</mo><mi>r</mi><mi>o</mi><mi>w</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mi>w</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">(col-1)\times wallSize\space,\space(row-1)\times wallSize</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">llS</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mspace">&nbsp;</span><span class="mpunct">,</span><span class="mspace">&nbsp;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.05764em;">llS</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span></span></span></span></span> with col = 20 and row = 11 in this example.</em></p>
<p>The <code>walls</code> table is then looped through and each instance of <code>Wall</code> is drawn on the screen by<br>
calling <code>draw()</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside main.lua ; love.draw()</span>
    <span class="token keyword keyword-for">for</span> k<span class="token punctuation">,</span> v <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>walls<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>
        v<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-end">end</span>
</code></pre><p>Recall that <code>draw()</code> is defined in <code>Wall</code>'s superclass <code>Entity</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--inside Entity.lua</span>
    <span class="token keyword keyword-function">function</span> Entity<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>image<span class="token punctuation">,</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span>self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token keyword keyword-end">end</span>
</code></pre><p>The result of such a map in this example looks like this (ignore the player and the platform):</p>
  <img alt="example map" src="./screenshots//mapExample.png">
<h2 id="animation">Animation </h2>
<p>There are only 3 animations in the entire game, player running, player jumping and the end waving flag. Animations are created by drawing a different sprite every multiple frames.</p>
<p>The sprites are first initialised and are put into a table. A global variable is then incremented per frame in <code>love.update()</code>. Finally, that variable is turned into an integer using <code>math.floor()</code> and indexed into the sprites table to find a sprite to draw every frame.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">-- static fields inside player.lua</span>
run <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
run<span class="token punctuation">.</span>frames <span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>run<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"sprites/player/player1.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>run<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"sprites/player/player2.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>run<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"sprites/player/player3.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">--...</span>

run<span class="token punctuation">.</span>currentFrame <span class="token operator">=</span> <span class="token number">1</span>
run<span class="token punctuation">.</span>animationSpeed <span class="token operator">=</span> <span class="token number">25</span>

jump <span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
jump<span class="token punctuation">.</span>frames <span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>jump<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"sprites/player/playerJump1.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>jump<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"sprites/player/playerJump2.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
table<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>jump<span class="token punctuation">.</span>frames<span class="token punctuation">,</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">newImage</span><span class="token punctuation">(</span><span class="token string">"sprites/player/playerJump3.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">--...</span>
jump<span class="token punctuation">.</span>currentFrame <span class="token operator">=</span> <span class="token number">1</span>
jump<span class="token punctuation">.</span>animationSpeed <span class="token operator">=</span> <span class="token number">75</span>
</code></pre><p><em>These fields can be static because there is only one instance of player at any given time.</em></p>
<p>In <code>Player.update()</code>, if the player is in the air, increment the <code>currentFrame</code> variable in the <code>jump</code> table. Otherwise increment the <code>currentFrame</code> variable in the <code>run</code> table. These variables are set back to 1 when they exceed <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>t</mi><mi>h</mi><mi>e</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mtext>&nbsp;</mtext><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>f</mi><mtext>&nbsp;</mtext><mi>s</mi><mi>p</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>o</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>o</mi><mi>p</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mtext>&nbsp;</mtext><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">(the\space total\space number\space of\space sprites\space to\space loop\space over\space )+ 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">mb</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mspace">&nbsp;</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oo</span><span class="mord mathnormal">p</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace">&nbsp;</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p>
<blockquote>
<p><code>animationSpeed</code> is multiplied onto <code>dt</code> to adjust how fast <code>currentFrame</code> reaches the next integer.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token comment">------------animation logic---------</span>
    <span class="token keyword keyword-if">if</span> <span class="token keyword keyword-not">not</span> self<span class="token punctuation">.</span>canJump <span class="token keyword keyword-then">then</span>
        <span class="token comment">--jump anim if canJump is false</span>
        jump<span class="token punctuation">.</span>currentFrame <span class="token operator">=</span> jump<span class="token punctuation">.</span>currentFrame <span class="token operator">+</span> jump<span class="token punctuation">.</span>animationSpeed<span class="token operator">*</span>dt

        <span class="token keyword keyword-if">if</span> jump<span class="token punctuation">.</span>currentFrame<span class="token operator">&gt;</span> <span class="token operator">#</span>jump<span class="token punctuation">.</span>frames <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword keyword-then">then</span>
            jump<span class="token punctuation">.</span>currentFrame <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-else">else</span>
        <span class="token comment">--walk anim if canJump is true</span>
        run<span class="token punctuation">.</span>currentFrame <span class="token operator">=</span> run<span class="token punctuation">.</span>currentFrame <span class="token operator">+</span> run<span class="token punctuation">.</span>animationSpeed<span class="token operator">*</span>dt

        <span class="token keyword keyword-if">if</span> run<span class="token punctuation">.</span>currentFrame<span class="token operator">&gt;</span> <span class="token operator">#</span>run<span class="token punctuation">.</span>frames <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword keyword-then">then</span>
            run<span class="token punctuation">.</span>currentFrame <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em>Recall <code>Player:update()</code> is called every frame in <code>love.update()</code>!</em></p>
<p>Lastly, the player is draw by using the <code>love.graphics</code> module and index the floored value of <code>currentFrame</code> into the sprite table.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> Player<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> <span class="token keyword keyword-not">not</span> self<span class="token punctuation">.</span>canJump <span class="token keyword keyword-then">then</span>
        <span class="token comment">--jump anim if canJump is false</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>jump<span class="token punctuation">.</span>frames<span class="token punctuation">[</span>math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>jump<span class="token punctuation">.</span>currentFrame<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>x<span class="token punctuation">,</span>player<span class="token punctuation">.</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-else">else</span>
        <span class="token comment">--walk anim if canJump is true</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>run<span class="token punctuation">.</span>frames<span class="token punctuation">[</span>math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>run<span class="token punctuation">.</span>currentFrame<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>x<span class="token punctuation">,</span>player<span class="token punctuation">.</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-end">end</span>
</code></pre><p>The end flag uses the exact same logic, the only difference is that its logic is placed in <code>main.lua</code> directly. The reason for this is because the flag does not have any non graphical purpose, so it is not necessary to abstract a few lines of code into another script.</p>
<h2 id="scoring">Scoring </h2>
<p>The scoring of this game depends on the time spent in the game scene. The elapsed time is calculated in seconds by incrementing a static variable <code>timer</code> in <code>main.lua</code> every frame. <code>score</code> is the time elapsed rounded to 3 decimal points. The <code>score</code> variable is then formatted into minutes, seconds and milliseconds.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
    timer <span class="token operator">=</span>  timer <span class="token operator">+</span> dt
    score <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span>timer<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
    score_text <span class="token operator">=</span> <span class="token function">formatScore</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>
<span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-function">function</span> <span class="token function">round</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
    k <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">^</span><span class="token punctuation">(</span>k <span class="token keyword keyword-or">or</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-return">return</span> math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>n<span class="token operator">*</span>k<span class="token operator">+</span><span class="token number">.5</span><span class="token punctuation">)</span><span class="token operator">/</span>k
<span class="token keyword keyword-end">end</span>

</code></pre><blockquote>
<p>Using the divison and remainder operator on <code>score</code>, the minutes and seconds can be extracted respectively. As for milliseconds, digits before the decimal point is first removed from <code>score</code>, then the remaining decimal is multiplied by 1000 to give milliseconds in 3 significant figures.</p>
</blockquote>
<blockquote>
<p><code>formatScore()</code> returns a concatenated score to display on the game scene.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> <span class="token function">formatScore</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>

    <span class="token keyword keyword-local">local</span> minutes <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%02d"</span><span class="token punctuation">,</span>score<span class="token operator">/</span><span class="token number">60</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-local">local</span> _seconds <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%02d"</span><span class="token punctuation">,</span>score<span class="token operator">%</span><span class="token number">60</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-local">local</span> milliSeconds <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%03d"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>score <span class="token operator">-</span> math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-local">local</span> s <span class="token operator">=</span> minutes <span class="token operator">..</span> <span class="token string">":"</span> <span class="token operator">..</span> _seconds <span class="token operator">..</span> <span class="token string">":"</span> <span class="token operator">..</span> milliSeconds
    <span class="token comment">--print("finished in:" .. minutes..":".. _seconds .. ":" .. milliSeconds)</span>
    <span class="token keyword keyword-return">return</span> s

<span class="token keyword keyword-end">end</span>
</code></pre><pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>playing <span class="token keyword keyword-then">then</span>

    <span class="token comment">------------On screen ui-------------</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token function">changeFont</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span>score_text<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">75</span> <span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token punctuation">,</span><span class="token string">"center"</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p>This process is executed every frame to create a timer on screen for the user to keep track of their performance.</p>
<h2 id="camera-follow-effect">Camera Follow Effect </h2>
<p>As mentioned before, in order to keep the player from moving out the screen, there must be a camera following the player. However, LOVE does not come with a camera component like other game engines, centering the player will require some transformations of the frame of reference.</p>
<p>To avoid confusion, (x,y)' will represent the coordinates in the translated frame of reference and (x,y) will represent the default frame of refernce.</p>
<p>Using <code>love.graphics.translate(dx,dy)</code>, the frame of reference is translated by <code>dx</code> and <code>dy</code>. The top left corner of the screen now has coordinates (-dx,-dy)', in other words, <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mi>d</mi><mi>x</mi><mo separator="true">,</mo><mo>−</mo><mi>d</mi><mi>y</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">(0,0) = (-dx,-dy)'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> .</p>
<img src="./screenshots/for1.png">
<p>Given that the position of the player is <code>x</code> and <code>y</code> in a particular frame, the default frame of reference is translated by <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mo>−</mo><mi>x</mi><mo>+</mo><mfrac><mrow><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi><mtext>&nbsp;</mtext><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi></mrow><mn>2</mn></mfrac><mo separator="true">,</mo><mo>−</mo><mi>y</mi><mo>+</mo><mfrac><mrow><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi><mtext>&nbsp;</mtext><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><mn>2</mn></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(-x + \frac{screen\space width}{2}, -y +\frac{screen\space height}{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">scree</span><span class="mord mathnormal">n</span><span class="mspace">&nbsp;</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">scree</span><span class="mord mathnormal">n</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span>. Therefore <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><msup><mo stretchy="false">)</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi><mtext>&nbsp;</mtext><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi></mrow><mn>2</mn></mfrac><mo separator="true">,</mo><mfrac><mrow><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>n</mi><mtext>&nbsp;</mtext><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow><mn>2</mn></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)' = (\frac{screen\space width}{2},\frac{screen\space height}{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0519em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">scree</span><span class="mord mathnormal">n</span><span class="mspace">&nbsp;</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">scree</span><span class="mord mathnormal">n</span><span class="mspace">&nbsp;</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span>, which means the player's position will be equal to the position of the center of the screen.</p>
<img src="./screenshots/for2.png">
<p>In <code>love.draw()</code>, the frame of reference is translated and only then is the player is drawn. This ensures the player stays at the center of the screen in every frame. All other scene objects are also drawn in the new frame of reference.</p>
<p>Due to the fact that images are pivoted at the top left corner, the translated player will appear to be slightly off-centered to the right and down. To correct for this behaviour, half of the image width and height of the player are subtracted on top of the player's position. This will align the center of the image to the center of the screen.</p>
<blockquote>
<p><code>love.graphics.translate()</code> is only called once per frame to center the player, everything else that are drawn in the new frame of reference appears to move relative to the player.</p>
</blockquote>
<p>The player in this game is placed at two-thirds of the screen's height instead of exactly half as shown in the example above. As a result, <code>dy</code> is <code>-player.y - player.image:getHeight()/2 + love.graphics.getHeight()*2/3</code> instead of <code>-player.y - player.image:getHeight()/2 + love.graphics.getHeight()*2</code>.</p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">----draws dynamic scene-----</span>

    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        dx <span class="token operator">=</span> <span class="token operator">-</span>player<span class="token punctuation">.</span>x <span class="token operator">-</span> player<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
        dy <span class="token operator">=</span> <span class="token operator">-</span>player<span class="token punctuation">.</span>y <span class="token operator">-</span> player<span class="token punctuation">.</span>image<span class="token punctuation">:</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">+</span> love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">3</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span>dy<span class="token punctuation">)</span>

        <span class="token comment">-----------------draw the player here</span>

        <span class="token comment">--animation--</span>
        player<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">-----------------draw the objects and map here</span>

        <span class="token comment">--entities--</span>
        <span class="token keyword keyword-for">for</span> k<span class="token punctuation">,</span> v <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>objects<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>
            <span class="token keyword keyword-if">if</span> <span class="token keyword keyword-not">not</span> v<span class="token punctuation">:</span><span class="token function">is</span><span class="token punctuation">(</span>Player<span class="token punctuation">)</span> <span class="token keyword keyword-then">then</span>
                v<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-end">end</span>

        <span class="token keyword keyword-for">for</span> k<span class="token punctuation">,</span> v <span class="token keyword keyword-in">in</span> <span class="token function">ipairs</span><span class="token punctuation">(</span>walls<span class="token punctuation">)</span> <span class="token keyword keyword-do">do</span>
            v<span class="token punctuation">:</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-end">end</span>

        <span class="token comment">--end flag animation--</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>flagIMG<span class="token punctuation">,</span> flag<span class="token punctuation">.</span>flagQuads<span class="token punctuation">[</span>math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>currentFrame<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>flag<span class="token punctuation">.</span>x<span class="token punctuation">,</span>flag<span class="token punctuation">.</span>y<span class="token punctuation">)</span>


    love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">-------draw other on-screen ui-------</span>

    <span class="token comment">-- use the default coordinate system!</span>
    <span class="token comment">-- static graphics are draw on top of the scene!</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em><code>love.graphics.push()</code> stores the current graphics settings to the stack and <code>love.graphics.pop()</code> retrieves those settings from the stack and apply them.</em></p>
<h2 id="text-flash-effect">Text Flash Effect </h2>
<p>Some text in this game have a flashing effect. To animate a text component, a timer variable <code>textFadeTimer</code> is counted down from half of <code>period</code> to half of -<code>period</code>. The absolute value of timer is then divided by half of <code>period</code> and stored into a global variable <code>textAlpha</code>. The value of <code>textAlpha</code> will lerp from 1 to 0 and then back to 1 again.</p>
<blockquote>
<p><code>loopValue()</code> is called inside <code>love.update()</code>. The argument <code>period</code> passed in to the function <code>loopValue()</code> is a constant defined in <code>love.load()</code> that can be adjusted for design purposes.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>menu <span class="token keyword keyword-then">then</span>

       <span class="token function">loopValue</span><span class="token punctuation">(</span>dt<span class="token punctuation">,</span>menuTextPeriod<span class="token punctuation">)</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p><em><code>menuTextPeriod</code> describes the constant period of which the menu text flashes in seconds.</em></p>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token comment">--forces a value to go from 1 to 0 back to 1 non stop</span>
<span class="token keyword keyword-function">function</span> <span class="token function">loopValue</span> <span class="token punctuation">(</span>dt<span class="token punctuation">,</span>period<span class="token punctuation">)</span>

    <span class="token comment">--forces timer to go from period/2 -&gt; - period/2 in exactly 1 period</span>
    <span class="token keyword keyword-if">if</span> textFadeTimer <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> period<span class="token operator">/</span><span class="token number">2</span> <span class="token keyword keyword-then">then</span>

        textFadeTimer <span class="token operator">=</span>  textFadeTimer <span class="token operator">-</span> dt

    <span class="token keyword keyword-else">else</span>

        textFadeTimer <span class="token operator">=</span> period<span class="token operator">/</span><span class="token number">2</span>

    <span class="token keyword keyword-end">end</span>

    textAlpha <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>textFadeTimer<span class="token operator">/</span><span class="token punctuation">(</span>period<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> textAlpha <span class="token operator">&gt;</span> <span class="token number">0.9</span> <span class="token keyword keyword-then">then</span>
        textAlpha <span class="token operator">=</span> <span class="token number">0.9</span>
    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><p>In <code>love.draw()</code>, in every frame before the text is printed on the screen, the pen colour's opacity is set to <code>textAlpha</code>.</p>
<blockquote>
<p>The text "Press SpaceBar to Play" will now appear to fade in and fade out with time.</p>
</blockquote>
<pre data-role="codeBlock" data-info="lua" class="language-lua lua"><code><span class="token keyword keyword-function">function</span> love<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-if">if</span> game<span class="token punctuation">.</span>state<span class="token punctuation">.</span>menu <span class="token keyword keyword-then">then</span>

        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>TextAlpha<span class="token punctuation">)</span>
        love<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Press SpaceBar to Play"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> WINDOWS_HEIGHT <span class="token operator">/</span><span class="token number">2</span>  <span class="token punctuation">,</span>WINDOWS_WIDTH<span class="token punctuation">,</span><span class="token string">"center"</span><span class="token punctuation">)</span>

    <span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-end">end</span>
</code></pre><h1 id="credits">Credits </h1>
<p>This game is inspired by <a href="https://sheepolution.com/learn"> Sheepolution's tutorial on how to love</a>. The physics system and overall data structure this game uses is a modified version of that in the tutorial. Sheepolution's tutorial is an essential beginner's starter pack if they are new to LOVE and lua.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>